////////////////////////
// BTCP Widget - v0.5 //
////////////////////////
btcpWidget.version = 0.5;

var jsonData = '{'+
        '"id"          : "widget_1",'+
        '"wallet"      : "'+address+'",'+
        '"amount"      : "'+amount+'",'+
        '"description" : "Pepperoni Pizza"'+
     '}';
// Handle the payment response with that JSON data
btcpWidget.data = JSON.parse(jsonData);

// Get hex string of UTC timestamp in ms as transaction ref
// TODO: needs more uniqueness. Also create at point payment received not on this JS script load
btcpWidget.transactionRef = Date.now().toString(16);

btcpWidget.getLocation = function(href) {
    var l = document.createElement("a");
    l.href = href;
    return l;
};

btcpURI = 'bitcoin:'+encodeURI(btcpWidget.data.wallet)+
          '?amount='+encodeURI(btcpWidget.data.amount)+
          '&message='+encodeURI(btcpWidget.data.description)+
          '&r='+encodeURI(btcpWidget.getLocation(window.location).origin);

// Data - would be obtained from DB of course, this is hardcoded for now
btcpWidgetData = {
    'btcpWidget' : {
        'name' : 'Default button',
        'type' : 'Buy',
        'width' : 'auto',
        'height' : 'auto',
        'padding' : '10px',
        'border_radius' : '5px',
        'color' : '#fff',
        'background' : '#272d63',
        'logo' : true
    },
    'widget_1' : {
        'name' : 'Supercart checkout button',
        'type' : 'Buy',
        'width' : 'auto',
        'height' : 'auto',
        'padding' : '10px',
        'border_radius' : '5px',
        'color' : '#fff',
        'background' : '#272d63',
        'logo' : true
    },
    'widget_2' : {
        'name' : 'Headphones R Us checkout',
        'type' : 'Buy',
        'width' : '150px',
        'height' : 'auto',
        'padding' : '10px',
        'border_radius' : '0',
        'color' : '#ff0',
        'background' : '#080',
        'logo' : false
    },
    'widget_3' : {
        'name' : 'Music for Kids Charity',
        'type' : 'Donate',
        'width' : 'auto',
        'height' : 'auto',
        'padding' : '5px',
        'border_radius' : '20px',
        'color' : '#fff',
        'background' : '#272d63',
        'logo' : false
    }
}

// QR code size
qrCodeWidth = 128;
qrCodeHeight = 128;

var approvalOnRecognition = false;
var approvalConfirmsNeeded = 6;

// QR code generator
(function(r){r.fn.qrcode=function(h){var s;function u(a){this.mode=s;this.data=a}function o(a,c){this.typeNumber=a;this.errorCorrectLevel=c;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function q(a,c){if(void 0==a.length)throw Error(a.length+"/"+c);for(var d=0;d<a.length&&0==a[d];)d++;this.num=Array(a.length-d+c);for(var b=0;b<a.length-d;b++)this.num[b]=a[b+d]}function p(a,c){this.totalCount=a;this.dataCount=c}function t(){this.buffer=[];this.length=0}u.prototype={getLength:function(){return this.data.length},
write:function(a){for(var c=0;c<this.data.length;c++)a.put(this.data.charCodeAt(c),8)}};o.prototype={addData:function(a){this.dataList.push(new u(a));this.dataCache=null},isDark:function(a,c){if(0>a||this.moduleCount<=a||0>c||this.moduleCount<=c)throw Error(a+","+c);return this.modules[a][c]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var a=1,a=1;40>a;a++){for(var c=p.getRSBlocks(a,this.errorCorrectLevel),d=new t,b=0,e=0;e<c.length;e++)b+=c[e].dataCount;
for(e=0;e<this.dataList.length;e++)c=this.dataList[e],d.put(c.mode,4),d.put(c.getLength(),j.getLengthInBits(c.mode,a)),c.write(d);if(d.getLengthInBits()<=8*b)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=Array(this.moduleCount);for(var b=0;b<this.moduleCount;b++)this.modules[d][b]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-
7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,c);7<=this.typeNumber&&this.setupTypeNumber(a);null==this.dataCache&&(this.dataCache=o.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,c){for(var d=-1;7>=d;d++)if(!(-1>=a+d||this.moduleCount<=a+d))for(var b=-1;7>=b;b++)-1>=c+b||this.moduleCount<=c+b||(this.modules[a+d][c+b]=
0<=d&&6>=d&&(0==b||6==b)||0<=b&&6>=b&&(0==d||6==d)||2<=d&&4>=d&&2<=b&&4>=b?!0:!1)},getBestMaskPattern:function(){for(var a=0,c=0,d=0;8>d;d++){this.makeImpl(!0,d);var b=j.getLostPoint(this);if(0==d||a>b)a=b,c=d}return c},createMovieClip:function(a,c,d){a=a.createEmptyMovieClip(c,d);this.make();for(c=0;c<this.modules.length;c++)for(var d=1*c,b=0;b<this.modules[c].length;b++){var e=1*b;this.modules[c][b]&&(a.beginFill(0,100),a.moveTo(e,d),a.lineTo(e+1,d),a.lineTo(e+1,d+1),a.lineTo(e,d+1),a.endFill())}return a},
setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(a=8;a<this.moduleCount-8;a++)null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupPositionAdjustPattern:function(){for(var a=j.getPatternPosition(this.typeNumber),c=0;c<a.length;c++)for(var d=0;d<a.length;d++){var b=a[c],e=a[d];if(null==this.modules[b][e])for(var f=-2;2>=f;f++)for(var i=-2;2>=i;i++)this.modules[b+f][e+i]=-2==f||2==f||-2==i||2==i||0==f&&0==i?!0:!1}},setupTypeNumber:function(a){for(var c=
j.getBCHTypeNumber(this.typeNumber),d=0;18>d;d++){var b=!a&&1==(c>>d&1);this.modules[Math.floor(d/3)][d%3+this.moduleCount-8-3]=b}for(d=0;18>d;d++)b=!a&&1==(c>>d&1),this.modules[d%3+this.moduleCount-8-3][Math.floor(d/3)]=b},setupTypeInfo:function(a,c){for(var d=j.getBCHTypeInfo(this.errorCorrectLevel<<3|c),b=0;15>b;b++){var e=!a&&1==(d>>b&1);6>b?this.modules[b][8]=e:8>b?this.modules[b+1][8]=e:this.modules[this.moduleCount-15+b][8]=e}for(b=0;15>b;b++)e=!a&&1==(d>>b&1),8>b?this.modules[8][this.moduleCount-
b-1]=e:9>b?this.modules[8][15-b-1+1]=e:this.modules[8][15-b-1]=e;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,c){for(var d=-1,b=this.moduleCount-1,e=7,f=0,i=this.moduleCount-1;0<i;i-=2)for(6==i&&i--;;){for(var g=0;2>g;g++)if(null==this.modules[b][i-g]){var n=!1;f<a.length&&(n=1==(a[f]>>>e&1));j.getMask(c,b,i-g)&&(n=!n);this.modules[b][i-g]=n;e--; -1==e&&(f++,e=7)}b+=d;if(0>b||this.moduleCount<=b){b-=d;d=-d;break}}}};o.PAD0=236;o.PAD1=17;o.createData=function(a,c,d){for(var c=p.getRSBlocks(a,
c),b=new t,e=0;e<d.length;e++){var f=d[e];b.put(f.mode,4);b.put(f.getLength(),j.getLengthInBits(f.mode,a));f.write(b)}for(e=a=0;e<c.length;e++)a+=c[e].dataCount;if(b.getLengthInBits()>8*a)throw Error("code length overflow. ("+b.getLengthInBits()+">"+8*a+")");for(b.getLengthInBits()+4<=8*a&&b.put(0,4);0!=b.getLengthInBits()%8;)b.putBit(!1);for(;!(b.getLengthInBits()>=8*a);){b.put(o.PAD0,8);if(b.getLengthInBits()>=8*a)break;b.put(o.PAD1,8)}return o.createBytes(b,c)};o.createBytes=function(a,c){for(var d=
0,b=0,e=0,f=Array(c.length),i=Array(c.length),g=0;g<c.length;g++){var n=c[g].dataCount,h=c[g].totalCount-n,b=Math.max(b,n),e=Math.max(e,h);f[g]=Array(n);for(var k=0;k<f[g].length;k++)f[g][k]=255&a.buffer[k+d];d+=n;k=j.getErrorCorrectPolynomial(h);n=(new q(f[g],k.getLength()-1)).mod(k);i[g]=Array(k.getLength()-1);for(k=0;k<i[g].length;k++)h=k+n.getLength()-i[g].length,i[g][k]=0<=h?n.get(h):0}for(k=g=0;k<c.length;k++)g+=c[k].totalCount;d=Array(g);for(k=n=0;k<b;k++)for(g=0;g<c.length;g++)k<f[g].length&&
(d[n++]=f[g][k]);for(k=0;k<e;k++)for(g=0;g<c.length;g++)k<i[g].length&&(d[n++]=i[g][k]);return d};s=4;for(var j={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,
78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var c=a<<10;0<=j.getBCHDigit(c)-j.getBCHDigit(j.G15);)c^=j.G15<<j.getBCHDigit(c)-j.getBCHDigit(j.G15);return(a<<10|c)^j.G15_MASK},getBCHTypeNumber:function(a){for(var c=a<<12;0<=j.getBCHDigit(c)-
j.getBCHDigit(j.G18);)c^=j.G18<<j.getBCHDigit(c)-j.getBCHDigit(j.G18);return a<<12|c},getBCHDigit:function(a){for(var c=0;0!=a;)c++,a>>>=1;return c},getPatternPosition:function(a){return j.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,c,d){switch(a){case 0:return 0==(c+d)%2;case 1:return 0==c%2;case 2:return 0==d%3;case 3:return 0==(c+d)%3;case 4:return 0==(Math.floor(c/2)+Math.floor(d/3))%2;case 5:return 0==c*d%2+c*d%3;case 6:return 0==(c*d%2+c*d%3)%2;case 7:return 0==(c*d%3+(c+d)%2)%2;default:throw Error("bad maskPattern:"+
a);}},getErrorCorrectPolynomial:function(a){for(var c=new q([1],0),d=0;d<a;d++)c=c.multiply(new q([1,l.gexp(d)],0));return c},getLengthInBits:function(a,c){if(1<=c&&10>c)switch(a){case 1:return 10;case 2:return 9;case s:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>c)switch(a){case 1:return 12;case 2:return 11;case s:return 16;case 8:return 10;default:throw Error("mode:"+a);}else if(41>c)switch(a){case 1:return 14;case 2:return 13;case s:return 16;case 8:return 12;default:throw Error("mode:"+
a);}else throw Error("type:"+c);},getLostPoint:function(a){for(var c=a.getModuleCount(),d=0,b=0;b<c;b++)for(var e=0;e<c;e++){for(var f=0,i=a.isDark(b,e),g=-1;1>=g;g++)if(!(0>b+g||c<=b+g))for(var h=-1;1>=h;h++)0>e+h||c<=e+h||0==g&&0==h||i==a.isDark(b+g,e+h)&&f++;5<f&&(d+=3+f-5)}for(b=0;b<c-1;b++)for(e=0;e<c-1;e++)if(f=0,a.isDark(b,e)&&f++,a.isDark(b+1,e)&&f++,a.isDark(b,e+1)&&f++,a.isDark(b+1,e+1)&&f++,0==f||4==f)d+=3;for(b=0;b<c;b++)for(e=0;e<c-6;e++)a.isDark(b,e)&&!a.isDark(b,e+1)&&a.isDark(b,e+
2)&&a.isDark(b,e+3)&&a.isDark(b,e+4)&&!a.isDark(b,e+5)&&a.isDark(b,e+6)&&(d+=40);for(e=0;e<c;e++)for(b=0;b<c-6;b++)a.isDark(b,e)&&!a.isDark(b+1,e)&&a.isDark(b+2,e)&&a.isDark(b+3,e)&&a.isDark(b+4,e)&&!a.isDark(b+5,e)&&a.isDark(b+6,e)&&(d+=40);for(e=f=0;e<c;e++)for(b=0;b<c;b++)a.isDark(b,e)&&f++;a=Math.abs(100*f/c/c-50)/5;return d+10*a}},l={glog:function(a){if(1>a)throw Error("glog("+a+")");return l.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;256<=a;)a-=255;return l.EXP_TABLE[a]},EXP_TABLE:Array(256),
LOG_TABLE:Array(256)},m=0;8>m;m++)l.EXP_TABLE[m]=1<<m;for(m=8;256>m;m++)l.EXP_TABLE[m]=l.EXP_TABLE[m-4]^l.EXP_TABLE[m-5]^l.EXP_TABLE[m-6]^l.EXP_TABLE[m-8];for(m=0;255>m;m++)l.LOG_TABLE[l.EXP_TABLE[m]]=m;q.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var c=Array(this.getLength()+a.getLength()-1),d=0;d<this.getLength();d++)for(var b=0;b<a.getLength();b++)c[d+b]^=l.gexp(l.glog(this.get(d))+l.glog(a.get(b)));return new q(c,0)},mod:function(a){if(0>
this.getLength()-a.getLength())return this;for(var c=l.glog(this.get(0))-l.glog(a.get(0)),d=Array(this.getLength()),b=0;b<this.getLength();b++)d[b]=this.get(b);for(b=0;b<a.getLength();b++)d[b]^=l.gexp(l.glog(a.get(b))+c);return(new q(d,0)).mod(a)}};p.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],
[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,
116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,
43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,
3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,
55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,
45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];p.getRSBlocks=function(a,c){var d=p.getRsBlockTable(a,c);if(void 0==d)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+c);for(var b=d.length/3,e=[],f=0;f<b;f++)for(var h=d[3*f+0],g=d[3*f+1],j=d[3*f+2],l=0;l<h;l++)e.push(new p(g,j));return e};p.getRsBlockTable=function(a,c){switch(c){case 1:return p.RS_BLOCK_TABLE[4*(a-1)+0];case 0:return p.RS_BLOCK_TABLE[4*(a-1)+1];case 3:return p.RS_BLOCK_TABLE[4*
(a-1)+2];case 2:return p.RS_BLOCK_TABLE[4*(a-1)+3]}};t.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>>>7-a%8&1)},put:function(a,c){for(var d=0;d<c;d++)this.putBit(1==(a>>>c-d-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var c=Math.floor(this.length/8);this.buffer.length<=c&&this.buffer.push(0);a&&(this.buffer[c]|=128>>>this.length%8);this.length++}};"string"===typeof h&&(h={text:h});h=r.extend({},{render:"canvas",width:qrCodeWidth,height:qrCodeHeight,typeNumber:-1,
correctLevel:2,background:"#ffffff",foreground:"#000000"},h);return this.each(function(){var a;if("canvas"==h.render){a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();var c=document.createElement("canvas");c.width=h.width;c.height=h.height;for(var d=c.getContext("2d"),b=h.width/a.getModuleCount(),e=h.height/a.getModuleCount(),f=0;f<a.getModuleCount();f++)for(var i=0;i<a.getModuleCount();i++){d.fillStyle=a.isDark(f,i)?h.foreground:h.background;var g=Math.ceil((i+1)*b)-Math.floor(i*b),
j=Math.ceil((f+1)*b)-Math.floor(f*b);d.fillRect(Math.round(i*b),Math.round(f*e),g,j)}}else{a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();c=r("<table></table>").css("width",h.width+"px").css("height",h.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",h.background);d=h.width/a.getModuleCount();b=h.height/a.getModuleCount();for(e=0;e<a.getModuleCount();e++){f=r("<tr></tr>").css("height",b+"px").appendTo(c);for(i=0;i<a.getModuleCount();i++)r("<td></td>").css("width",
d+"px").css("background-color",a.isDark(e,i)?h.foreground:h.background).appendTo(f)}}a=c;jQuery(a).appendTo(this)})}})(jQuery);

// SVG BTCP logo
btcpLogo = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="-678 877.2 226.8 226.8"><switch><g><path d="M-564.6 877.2c-62.6 0-113.4 50.8-113.4 113.4s50.8 113.4 113.4 113.4c62.6 0 113.4-50.8 113.4-113.4S-502 877.2-564.6 877.2zm58.6 154.5c-8.1 23.3-27.4 25.2-53.1 20.4l-6.2 25-14.9-3.7 5.8-23.9.2-.8 4.5-18.4c13.3 3 31.3 4.8 34.8-9 1.8-7.4-1.7-12.7-7.4-16.6 2-.1 3.9-.2 5.9-.3 4.3-.2 6.4-.5 10.6-1.3 4.3-.7 9.4-2.4 13-3.7.2-.1.3-.1.5-.2 7.7 6.9 11.4 18.1 6.3 32.5zm5.4-58.3c-.8 5.6-2.8 11.1-6.7 15.3-3.4 3.6-8.7 5.5-13.3 7-5.4 1.8-11.2 2.9-16.9 2.9-3.8 0-7.7-.1-11.5-.4-6.2-.5-12.6-1-18.7-2.4-2-.5-3.7-.8-5.5-1.3l-8.3 33.2-4.9 18.1-6.2 24.8-15-3.8 6.2-25.1c-3.5-.9-7.1-1.9-10.7-2.8l-19.6-4.9 7.5-17.3s11.1 3 11 2.7c4.3 1.1 6.2-1.7 6.9-3.6l8.5-34 3.9-15.8 4.5-18.1c.2-3.2-.9-7.2-7-8.8.2-.2-10.9-2.7-10.9-2.7l4-16.1 20.8 5.3c3.1.8 6.3 1.5 9.6 2.3l6.2-24.8 15.1 3.8-6 24.3c4 .9 8.1 1.9 12.1 2.8l6-24.1 15.1 3.8-6.2 24.8c18.8 6.8 32.8 16.6 30 34.9zm-61.2-24.1l-7.5 30.1c8.5 2.1 34.7 10.8 39-6.3 4.4-17.7-23-21.7-31.5-23.8z" fill="white" /></g></switch></svg>';

btcpLogoFull = '<?xml version="1.0" encoding="UTF-8"?><svg width="799px" height="145px" viewBox="0 0 799 145" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 48.2 (47327) - http://www.bohemiancoding.com/sketch --><title>logo</title><desc>Created with Sketch.</desc><defs></defs><g id="logo-v2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(-200.000000, -127.000000)"><g id="logo" transform="translate(200.000000, 127.000000)"><g id="Group"><path d="M142.124239,90.1653416 C132.514326,128.761027 93.4715991,152.248346 54.9205115,142.624583 C16.3847193,133.00082 -7.07631502,93.9107114 2.54015251,55.3172138 C12.1456947,16.7193409 51.1884218,-6.77016552 89.7285841,2.85140934 C128.277487,12.4729842 151.734151,51.5696564 142.124239,90.1653416" id="Fill-4" fill="#272D63"></path><path d="M98.0058258,81.9336227 C95.3050865,82.3996062 93.9656421,82.5746235 91.2321268,82.7343268 C89.9844552,82.8087091 88.7324134,82.8874669 87.4781865,82.9552861 C91.1053931,85.4427191 93.3778599,88.8424298 92.2001102,93.570084 C90.0041207,102.397518 78.4866473,101.19865 69.9692671,99.3062753 L67.1046479,111.043371 L67.106833,111.043371 L66.9779142,111.557485 L63.2458246,126.836493 L72.8032954,129.221104 L76.7888525,113.233275 C93.2096099,116.344207 105.557408,115.086271 110.75349,100.216365 C113.987385,90.9732651 111.644997,83.8522496 106.6412,79.4221248 C106.534131,79.47463 106.427063,79.5227597 106.324365,79.5599509 C103.999457,80.4000338 100.728416,81.4654515 98.0058258,81.9336227" id="Fill-6" fill="#FEFEFE"></path><path d="M95.1783527,62.5069236 C92.462318,73.3995615 75.7050606,67.86464 70.2686209,66.5082561 L75.0626517,47.2585433 C80.4990915,48.6149272 98.0058258,51.1483023 95.1783527,62.5069236 M98.8427054,24.6703758 L89.2131275,22.266076 L85.3739697,37.6872859 C82.8414803,37.0572237 80.2412539,36.4621649 77.6563229,35.8714816 L81.5238866,20.3474491 L71.9008638,17.9453369 L67.9546379,33.7778374 C65.8591613,33.3009154 63.8030159,32.8283687 61.8058673,32.3317572 L48.5359724,28.9626746 L45.9728921,39.2602537 C45.9728921,39.2602537 53.118052,40.8988529 52.9694676,41.0016756 C56.8676222,41.9752092 57.5733979,44.5589018 57.4554044,46.6066039 L54.5754898,58.1730583 L52.0670361,68.2474903 L46.650262,89.9955748 C46.1717329,91.1835046 44.9633924,92.9643054 42.2364323,92.2861135 C42.3325751,92.428315 35.2354866,90.5381284 35.2354866,90.5381284 L30.4567512,101.572968 L42.9880944,104.701402 C45.3195579,105.28771 47.60295,105.90027 49.851381,106.477827 L45.868009,122.496283 L55.4844765,124.900583 L59.4328875,109.048393 L62.5618995,97.4491232 L67.8497548,76.2239028 C68.9619525,76.4951796 70.0741502,76.738016 71.3393024,77.0267945 C75.2243465,77.932509 79.3016763,78.2672295 83.2675678,78.5647589 C85.7060995,78.7463393 88.1533714,78.8688514 90.5984582,78.8382234 C94.2431453,78.7922813 97.9621245,78.1119017 101.407971,76.9567876 C104.300996,75.9898172 107.742472,74.7515699 109.89039,72.4697822 C112.403214,69.8007687 113.666181,66.2544811 114.201522,62.6797532 C115.947388,50.9864113 107.056362,44.7011033 94.8986645,40.5094395 L98.8427054,24.6703758 Z" id="Fill-8" fill="#FEFEFE"></path></g><g id="Group-2" transform="translate(170.984920, 31.404663)"><path d="M363.803074,5.86479489 C372.307172,5.86479489 378.72029,7.47075556 383.04262,10.6827251 C387.364951,13.8946946 389.526084,18.5729278 389.526084,24.7175652 C389.526084,29.465694 388.630004,33.5678761 386.837819,37.0242346 C385.045633,40.4805931 382.497956,43.3259365 379.194711,45.5603501 C375.891467,47.7947636 371.920604,49.4530926 367.282006,50.5353867 C362.643407,51.6176807 357.477772,52.1588197 351.784946,52.1588197 L344.510816,52.1588197 L337.974642,79.1811237 L327.748691,79.1811237 L345.037927,7.54059669 C347.989763,6.84234245 351.117256,6.388484 354.420501,6.17900773 C357.723745,5.96953146 360.851238,5.86479489 363.803074,5.86479489 Z M362.538008,14.4532791 C357.548,14.4532791 354.525928,14.5929279 353.471701,14.8722296 L346.513838,43.675073 L353.155435,43.675073 C356.10727,43.675073 359.129342,43.4132316 362.221741,42.8895409 C365.314141,42.3658503 368.09023,41.4406773 370.550093,40.1139942 C373.009956,38.7873111 375.030527,36.9544213 376.611868,34.6152695 C378.193208,32.2761178 378.983867,29.2562135 378.983867,25.5554661 C378.983867,21.5754169 377.507971,18.7300735 374.556136,17.0193506 C371.6043,15.3086277 367.598297,14.4532791 362.538008,14.4532791 Z M416.443879,23.5654514 C417.28726,23.5654514 418.23605,23.6003636 419.290277,23.670189 C420.344504,23.7400145 421.381145,23.8622071 422.400231,24.0367707 C423.419317,24.2113342 424.350537,24.3858952 425.193919,24.5604587 C426.0373,24.7350223 426.669827,24.9270393 427.091518,25.1365156 L424.245119,33.6202622 C422.839483,33.0616588 421.223026,32.6427126 419.395699,32.3634109 C417.568373,32.0841092 415.811354,31.9444604 414.124591,31.9444604 C412.648673,31.9444604 411.190348,32.049197 409.749571,32.2586733 C408.308794,32.4681495 407.061311,32.747447 406.007084,33.0965742 L394.832333,79.1811237 L385.028071,79.1811237 L397.678732,26.8123174 C400.490004,25.8347615 403.512076,25.0492372 406.745039,24.4557211 C409.978002,23.862205 413.210916,23.5654514 416.443879,23.5654514 Z M429.656791,79.1811237 L419.852529,79.1811237 L433.0303,24.7175652 L442.834562,24.7175652 L429.656791,79.1811237 Z M441.042385,14.8722296 C439.425904,14.8722296 438.073,14.3834589 436.983632,13.405903 C435.894264,12.4283471 435.349588,11.0667717 435.349588,9.32113611 C435.349588,7.08672253 436.052396,5.32365702 437.458032,4.03188667 C438.863668,2.74011632 440.444984,2.09424084 442.202029,2.09424084 C443.818511,2.09424084 445.188985,2.60046757 446.313494,3.61293622 C447.438003,4.62540487 448.000249,6.0393485 448.000249,7.85480953 C448.000249,9.94957226 447.262301,11.6428134 445.786383,12.9345837 C444.310465,14.2263541 442.729149,14.8722296 441.042385,14.8722296 Z M454.044453,79.1811237 C453.201072,75.6200271 452.392843,71.709862 451.619743,67.4505111 C450.846644,63.1911602 450.143836,58.7398562 449.5113,54.0964655 C448.878764,49.4530748 448.351658,44.6526489 447.929967,39.6950438 C447.508277,34.7374386 447.227154,29.7449957 447.08659,24.7175652 L456.996274,24.7175652 C457.066556,28.1390109 457.224688,31.7873346 457.470674,35.6626457 C457.71666,39.5379567 458.015353,43.4132096 458.366762,47.2885207 C458.718171,51.1638317 459.139856,54.8994359 459.631828,58.4954452 C460.123801,62.0914546 460.650907,65.3557442 461.213161,68.288412 C463.321615,65.6350459 465.517888,62.510405 467.802047,58.9143957 C470.086205,55.3183863 472.282479,51.54787 474.390933,47.6027335 C476.499387,43.657597 478.432107,39.6950637 480.189152,35.7150145 C481.946197,31.7349653 483.351812,28.0691855 484.406039,24.7175652 L494.315723,24.7175652 C492.769524,29.3260432 490.801663,34.109013 488.412081,39.0666181 C486.0225,44.0242232 483.439683,48.8944735 480.663552,53.677515 C477.887421,58.4605566 474.97077,63.0515094 471.913512,67.4505111 C468.856253,71.8495128 465.886892,75.7596779 463.005338,79.1811237 L454.044453,79.1811237 Z M525.555827,79.8095494 C525.204418,79.0414697 524.853014,78.1861211 524.501605,77.2434779 C524.150196,76.3008346 523.869073,75.3058373 523.658228,74.2584559 C522.112028,75.6549644 520.038746,77.0514519 517.43832,78.4479604 C514.837893,79.8444689 511.640119,80.5427127 507.844902,80.5427127 C504.752503,80.5427127 502.099405,80.053942 499.885528,79.0763861 C497.671651,78.0988302 495.861922,76.7372548 494.456286,74.9916192 C493.05065,73.2459836 492.014009,71.1861645 491.346332,68.8121001 C490.678655,66.4380356 490.344821,63.8196215 490.344821,60.9567791 C490.344821,56.2784757 491.13548,51.704979 492.71682,47.2361519 C494.298161,42.7673247 496.670136,38.7873352 499.832817,35.296064 C502.995498,31.8047928 506.96636,28.9769056 511.745522,26.8123174 C516.524685,24.6477293 522.112004,23.5654514 528.507648,23.5654514 C530.405256,23.5654514 532.6191,23.7749245 535.149244,24.1938771 C537.679389,24.6128296 539.858092,25.3110734 541.685419,26.2886293 L533.567912,59.1762397 C533.216503,60.7822245 532.91781,62.3183607 532.671823,63.7846947 C532.425837,65.2510286 532.302846,66.7871649 532.302846,68.3931496 C532.302846,69.9991344 532.443407,71.6225511 532.724534,73.2634486 C533.005662,74.9043461 533.497627,76.6674116 534.200445,78.552698 L525.555827,79.8095494 Z M509.847923,72.2684413 C512.799759,72.2684413 515.329866,71.6400219 517.43832,70.3831642 C519.546774,69.1263066 521.374073,67.6599947 522.920272,65.9841845 C522.990554,64.7971523 523.113546,63.5577696 523.28925,62.2659993 C523.464955,60.9742289 523.693367,59.6650219 523.974494,58.3383388 L530.299825,32.3634109 C529.948416,32.22376 529.368599,32.1190235 528.560359,32.049198 C527.752118,31.9793726 527.03174,31.9444604 526.399204,31.9444604 C522.393142,31.9444604 518.773683,32.7125286 515.54072,34.2486879 C512.307758,35.7848472 509.549238,37.8272103 507.26508,40.3758382 C504.980921,42.9244662 503.223903,45.8920022 501.993971,49.2785353 C500.76404,52.6650684 500.149083,56.2086555 500.149083,59.909403 C500.149083,61.3757369 500.289645,62.8595049 500.570772,64.3607515 C500.851899,65.8619981 501.361435,67.1886613 502.099393,68.3407808 C502.837352,69.4929003 503.821283,70.4355294 505.051214,71.1686963 C506.281146,71.9018633 507.880033,72.2684413 509.847923,72.2684413 Z M559.747751,80.6474503 C554.476616,80.6474503 550.611175,79.4953481 548.151312,77.1911091 C545.691449,74.8868701 544.461536,71.5353 544.461536,67.1362983 C544.461536,64.2734559 544.953502,60.6076761 545.937447,56.1388489 L557.217619,9.53061133 L567.44357,7.85480953 L563.332105,24.7175652 L581.99183,24.7175652 L579.988808,32.8870989 L561.329084,32.8870989 L555.530864,56.9767498 C554.687483,60.2585448 554.265798,63.1213442 554.265798,65.5652341 C554.265798,67.8694731 554.898325,69.527802 556.163397,70.5402707 C557.42847,71.5527393 559.536892,72.058966 562.488728,72.058966 C564.5269,72.058966 566.529901,71.7273003 568.497792,71.0639587 C570.465682,70.4006172 571.976718,69.7896539 573.030945,69.2310505 L573.7689,77.5053219 C572.714673,78.1337507 570.922514,78.8145384 568.392369,79.5477053 C565.862225,80.2808723 562.980714,80.6474503 559.747751,80.6474503 Z M590.566166,50.5877555 C594.642511,50.4481046 598.36739,50.1862632 601.740917,49.8022234 C605.114443,49.4181835 608.031094,48.754852 610.490957,47.8122087 C612.95082,46.8695655 614.86597,45.5952706 616.236465,43.9892859 C617.60696,42.3833011 618.292198,40.2885698 618.292198,37.7050291 C618.292198,37.0766003 618.169206,36.4132687 617.92322,35.7150145 C617.677234,35.0167602 617.255549,34.3708848 616.658154,33.7773686 C616.060759,33.1838525 615.23496,32.6950819 614.180733,32.3110421 C613.126506,31.9270022 611.826312,31.7349852 610.280112,31.7349852 C607.820249,31.7349852 605.518555,32.258668 603.37496,33.3060494 C601.231365,34.3534308 599.316215,35.7324622 597.629452,37.4431851 C595.942689,39.153908 594.501933,41.1439027 593.307143,43.413229 C592.112352,45.6825553 591.198702,48.0740402 590.566166,50.5877555 Z M600.581273,80.5427127 C596.996901,80.5427127 593.904548,80.0364859 591.304121,79.0240173 C588.703695,78.0115486 586.524992,76.6150611 584.767947,74.8345128 C583.010902,73.0539645 581.710708,70.9766893 580.867326,68.6026248 C580.023945,66.2285604 579.60226,63.7148828 579.60226,61.0615167 C579.60226,56.173737 580.340208,51.4605916 581.816126,46.921939 C583.292044,42.3832865 585.400466,38.3683848 588.141456,34.8771136 C590.882446,31.3858424 594.220782,28.6103234 598.156563,26.5504734 C602.092343,24.4906234 606.555171,23.4607138 611.545179,23.4607138 C614.426732,23.4607138 616.904129,23.8272918 618.977442,24.5604587 C621.050755,25.2936257 622.737493,26.2886231 624.037706,27.5454807 C625.337919,28.8023383 626.304279,30.2511942 626.936816,31.8920916 C627.569352,33.5329891 627.885615,35.2262302 627.885615,36.9718658 C627.885615,40.2536608 627.288229,43.0291797 626.093438,45.298506 C624.898648,47.5678323 623.317331,49.4705466 621.349441,51.0067059 C619.38155,52.5428652 617.079856,53.7298797 614.444288,54.5677847 C611.808721,55.4056898 609.067772,56.0690214 606.221359,56.5577994 C603.374946,57.0465774 600.493435,57.3782431 597.576741,57.5528067 C594.660046,57.7273703 591.901527,57.8844751 589.3011,58.024126 C589.230818,58.5827294 589.195678,59.0365878 589.195678,59.3857149 L589.195678,60.2236158 C589.195678,61.8296006 589.38895,63.3482808 589.7755,64.779702 C590.16205,66.2111232 590.882428,67.467962 591.936655,68.550256 C592.990882,69.6325501 594.449207,70.4878987 596.311675,71.1163275 C598.174142,71.7447564 600.616398,72.058966 603.638516,72.058966 C604.97387,72.058966 606.361915,71.9367734 607.802691,71.6923844 C609.243468,71.4479954 610.613943,71.1337857 611.914156,70.7497459 C613.214369,70.3657061 614.374002,69.981672 615.393088,69.5976322 C616.412174,69.2135923 617.132552,68.8470143 617.554242,68.4978872 L618.39762,76.7721586 C616.991984,77.5402383 614.72543,78.3606747 611.59789,79.2334925 C608.47035,80.1063103 604.798181,80.5427127 600.581273,80.5427127 Z" id="Private" fill="#75A0D5"></path><path d="M24.9850548,81.1716498 C20.7681468,81.1716498 16.445881,80.9970888 12.0181276,80.6479617 C7.59037426,80.2988346 3.58437177,79.7402396 0,78.9721599 L16.8675475,8.79795946 C20.8736101,8.02987979 25.0728846,7.50619697 29.4654971,7.22689527 C33.8581096,6.94759357 37.8816823,6.80794482 41.5363358,6.80794482 C45.7532438,6.80794482 49.3902724,7.24434717 52.4475306,8.11716498 C55.5047889,8.98998278 57.9997554,10.1595411 59.9325049,11.625875 C61.8652544,13.0922089 63.3060096,14.8203622 64.2548139,16.8103868 C65.2036182,18.8004114 65.6780132,20.9125988 65.6780132,23.1470124 C65.6780132,24.6831717 65.5198816,26.2891324 65.2036135,27.9649426 C64.8873454,29.6407527 64.2548187,31.2990817 63.3060144,32.9399792 C62.3572101,34.5808766 61.0570163,36.134469 59.405394,37.6008029 C57.7537717,39.0671368 55.5926388,40.3938 52.9219304,41.5808322 C56.0846114,42.9773407 58.403876,44.880055 59.8797938,47.2890321 C61.3557116,49.6980092 62.0936594,52.3687916 62.0936594,55.3014594 C62.0936594,58.6530798 61.4259923,61.8824572 60.0906381,64.9896886 C58.7552839,68.09692 56.6117212,70.8549829 53.6598856,73.26396 C50.70805,75.6729371 46.8777494,77.5931075 42.1688689,79.0245287 C37.4599883,80.4559499 31.7321076,81.1716498 24.9850548,81.1716498 Z M23.5091444,48.4935146 L18.975991,67.3462849 C20.1004998,67.5557612 21.5236849,67.712866 23.245589,67.8176042 C24.967493,67.9223423 26.56638,67.9747106 28.0422978,67.9747106 C30.1507518,67.9747106 32.2416039,67.8176057 34.314917,67.5033913 C36.3882301,67.1891769 38.2506699,66.6131258 39.9022922,65.7752207 C41.5539144,64.9373156 42.9068188,63.7852134 43.9610458,62.3188795 C45.0152728,60.8525456 45.5423784,58.9672874 45.5423784,56.6630484 C45.5423784,55.6854925 45.3491063,54.7079512 44.9625564,53.7303953 C44.5760065,52.7528393 43.96105,51.8800346 43.1176684,51.1119549 C42.2742868,50.3438753 41.1673651,49.7154559 39.79687,49.2266779 C38.4263749,48.7378999 36.7923476,48.4935146 34.894739,48.4935146 L23.5091444,48.4935146 Z M26.5663874,36.239214 L36.8977603,36.239214 C41.1146682,36.239214 44.2597316,35.3314971 46.3330447,33.516036 C48.4063577,31.700575 49.4429987,29.5360193 49.4429987,27.022304 C49.4429987,25.695621 49.1443056,24.5609749 48.5469103,23.6183316 C47.949515,22.6756884 47.1588566,21.9250764 46.1749114,21.366473 C45.1909662,20.8078696 44.0664743,20.4063794 42.8014019,20.1619904 C41.5363295,19.9176014 40.2361357,19.7954088 38.9007815,19.7954088 C37.4248637,19.7954088 35.843547,19.8477771 34.1567838,19.9525152 C32.4700206,20.0572533 31.2049672,20.179446 30.3615856,20.3190968 L26.5663874,36.239214 Z M80.0505694,80.2290112 L64.4480879,80.2290112 L77.6258594,25.137027 L93.3337631,25.137027 L80.0505694,80.2290112 Z M87.6409658,18.4338198 C85.46223,18.4338198 83.4943691,17.7879443 81.7373241,16.496174 C79.9802792,15.2044036 79.1017698,13.231865 79.1017698,10.5784989 C79.1017698,9.11216496 79.400463,7.73313352 79.9978583,6.44136317 C80.5952536,5.14959283 81.385912,4.0324028 82.3698572,3.08975957 C83.3538024,2.14711634 84.4958645,1.39650429 85.7960778,0.837900901 C87.0962911,0.279297507 88.4843358,0 89.9602536,0 C92.1389894,0 94.1068502,0.645875485 95.8638952,1.93764583 C97.6209402,3.22941618 98.4994495,5.20195483 98.4994495,7.85532094 C98.4994495,9.32165485 98.2007563,10.7006863 97.603361,11.9924566 C97.0059658,13.284227 96.2153074,14.401417 95.2313622,15.3440602 C94.247417,16.2867035 93.1053549,17.0373155 91.8051416,17.5959189 C90.5049283,18.1545223 89.1168836,18.4338198 87.6409658,18.4338198 Z M104.965343,11.4163998 L121.305779,8.90269707 L117.299737,25.137027 L134.799817,25.137027 L131.637152,37.9150158 L114.242494,37.9150158 L109.603918,57.1867365 C109.182228,58.7927212 108.918675,60.2939453 108.813252,61.6904538 C108.707829,63.0869623 108.883531,64.2914328 109.340363,65.3039015 C109.797195,66.3163701 110.587853,67.1018943 111.712362,67.6604977 C112.836871,68.2191011 114.383047,68.4983986 116.350937,68.4983986 C118.037701,68.4983986 119.671728,68.3412938 121.253068,68.0270794 C122.834409,67.712865 124.433296,67.2764626 126.049777,66.7178592 L127.209421,78.6579471 C125.100967,79.4260267 122.816843,80.0893583 120.35698,80.6479617 C117.897117,81.2065651 114.980466,81.4858626 111.60694,81.4858626 C106.757495,81.4858626 102.997476,80.7701627 100.326767,79.3387415 C97.6560588,77.9073203 95.7584787,75.9522378 94.6339699,73.4734352 C93.5094611,70.9946327 93.0174959,68.1492893 93.1580595,64.9373198 C93.2986231,61.7253503 93.7905883,58.338868 94.6339699,54.7777714 L104.965343,11.4163998 Z M130.934338,58.2341126 C130.934338,53.4859838 131.707426,49.0172236 133.253626,44.8276982 C134.799825,40.6381727 137.013669,36.972393 139.895222,33.8302489 C142.776776,30.6881048 146.273243,28.2093394 150.384729,26.3938784 C154.496214,24.5784173 159.082032,23.6707004 164.142322,23.6707004 C167.305003,23.6707004 170.133803,23.967454 172.628807,24.5609702 C175.123811,25.1544863 177.390365,25.9400105 179.428537,26.9175664 L174.052006,39.0671295 C172.64637,38.5085261 171.188045,38.0022994 169.676986,37.5484341 C168.165927,37.0945689 166.321058,36.8676396 164.142322,36.8676396 C158.871187,36.8676396 154.724623,38.6307051 151.702506,42.1568891 C148.680388,45.683073 147.169352,50.4834989 147.169352,56.5583108 C147.169352,60.1194074 147.942441,62.999663 149.48864,65.1991638 C151.03484,67.3986647 153.88121,68.4983986 158.027836,68.4983986 C160.066008,68.4983986 162.033869,68.2889255 163.931478,67.869973 C165.829086,67.4510204 167.515824,66.9273376 168.991742,66.2989088 L170.151386,78.7626847 C168.183495,79.5307643 166.022363,80.211552 163.667922,80.8050681 C161.313482,81.3985842 158.449542,81.6953378 155.076015,81.6953378 C150.718544,81.6953378 147.028805,81.0669184 144.006687,79.8100608 C140.98457,78.5532032 138.489603,76.859962 136.521713,74.7302866 C134.553823,72.6006111 133.130637,70.1043897 132.252115,67.2415473 C131.373592,64.3787049 130.934338,61.3762567 130.934338,58.2341126 Z M196.436647,81.6953378 C192.711712,81.6953378 189.478798,81.1367428 186.737808,80.019536 C183.996817,78.9023292 181.730263,77.3312808 179.938077,75.3063435 C178.145892,73.2814062 176.792987,70.8899212 175.879324,68.131817 C174.96566,65.3737127 174.508836,62.3188962 174.508836,58.9672759 C174.508836,54.7777504 175.194073,50.5882878 176.564568,46.3987624 C177.935063,42.2092369 179.955635,38.4387206 182.626343,35.0871002 C185.297051,31.7354799 188.565106,28.9948731 192.430605,26.8651976 C196.296104,24.7355222 200.723791,23.6707004 205.713799,23.6707004 C209.368452,23.6707004 212.583796,24.2292955 215.359927,25.3465022 C218.136058,26.463709 220.420183,28.0347575 222.212369,30.0596948 C224.004554,32.0846321 225.357459,34.476117 226.271122,37.2342213 C227.184786,39.9923255 227.64161,43.047142 227.64161,46.3987624 C227.64161,50.5882878 226.973943,54.7777504 225.638589,58.9672759 C224.303235,63.1568013 222.335374,66.9273177 219.734947,70.278938 C217.134521,73.6305584 213.884036,76.3711652 209.983397,78.5008406 C206.082757,80.6305161 201.567219,81.6953378 196.436647,81.6953378 Z M204.237888,36.8676396 C201.918589,36.8676396 199.880447,37.5309712 198.123402,38.8576543 C196.366357,40.1843373 194.890462,41.8601224 193.695671,43.8850597 C192.50088,45.909997 191.604801,48.1269209 191.007406,50.5358981 C190.41001,52.9448752 190.111317,55.2316236 190.111317,57.3962117 C190.111317,60.9573083 190.673563,63.6979151 191.798072,65.6181143 C192.922581,67.5383135 194.960722,68.4983986 197.912558,68.4983986 C200.231857,68.4983986 202.269999,67.8350671 204.027044,66.508384 C205.784089,65.1817009 207.259984,63.5059159 208.454775,61.4809786 C209.649566,59.4560413 210.545645,57.2391173 211.14304,54.8301402 C211.740436,52.4211631 212.039129,50.1344147 212.039129,47.9698266 C212.039129,44.4087299 211.476883,41.6681231 210.352374,39.747924 C209.227865,37.8277248 207.189724,36.8676396 204.237888,36.8676396 Z M243.068388,80.2290112 L227.465907,80.2290112 L240.643678,25.137027 L256.351582,25.137027 L243.068388,80.2290112 Z M250.658785,18.4338198 C248.480049,18.4338198 246.512188,17.7879443 244.755143,16.496174 C242.998098,15.2044036 242.119589,13.231865 242.119589,10.5784989 C242.119589,9.11216496 242.418282,7.73313352 243.015677,6.44136317 C243.613072,5.14959283 244.403731,4.0324028 245.387676,3.08975957 C246.371621,2.14711634 247.513683,1.39650429 248.813897,0.837900901 C250.11411,0.279297507 251.502155,0 252.978072,0 C255.156808,0 257.124669,0.645875485 258.881714,1.93764583 C260.638759,3.22941618 261.517268,5.20195483 261.517268,7.85532094 C261.517268,9.32165485 261.218575,10.7006863 260.62118,11.9924566 C260.023785,13.284227 259.233126,14.401417 258.249181,15.3440602 C257.265236,16.2867035 256.123174,17.0373155 254.82296,17.5959189 C253.522747,18.1545223 252.134702,18.4338198 250.658785,18.4338198 Z M265.663874,27.6507297 C266.858664,27.3016026 268.176428,26.9001124 269.617205,26.4462472 C271.057982,25.9923819 272.674439,25.5734357 274.466625,25.1893958 C276.258811,24.805356 278.261812,24.4911463 280.475689,24.2467573 C282.689566,24.0023683 285.202102,23.8801757 288.013374,23.8801757 C296.306627,23.8801757 301.999367,26.2542045 305.091766,31.0023333 C308.184165,35.7504622 308.711271,42.2441292 306.673099,50.4835293 L299.504391,80.2290112 L283.796487,80.2290112 L290.754351,51.1119549 C291.176042,49.2964939 291.509875,47.5334284 291.755861,45.8227055 C292.001848,44.1119826 291.984278,42.6107585 291.70315,41.3189882 C291.422023,40.0272178 290.771926,38.9798522 289.75284,38.1768598 C288.733754,37.3738674 287.170007,36.9723772 285.061553,36.9723772 C283.023381,36.9723772 280.950099,37.1818504 278.841645,37.6008029 L268.615695,80.2290112 L252.907791,80.2290112 L265.663874,27.6507297 Z" id="Bitcoin" fill="#272D63"></path></g></g></g></svg>';

clipboardIcon = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve"><g><path d="M779.5,82.6h-76.2V64.4c0-29-29-54.4-65.3-54.4H365.7c-36.3,0-65.3,25.4-65.3,54.4v18.1h-79.9c-36.3,0-65.3,29-65.3,65.3v776.7c0,36.3,29,65.3,65.3,65.3h559c36.3,0,65.3-29,65.3-69V147.9C844.8,111.6,815.8,82.6,779.5,82.6z M333,64.4c0-10.9,14.5-18.1,29-18.1h272.2c14.5,0,29,7.3,29,18.1v90.7H336.7H333V64.4z M808.5,921c0,14.5-14.5,29-29,29h-559c-14.5,0-29-10.9-29-29V147.9c0-14.5,14.5-29,29-29h79.9v72.6h399.3h3.6v-72.6h76.2c14.5,0,29,10.9,29,29V921z" fill="white"/></g></svg>';

// Get selector function
var get = function(elem) {
    return document.getElementById(elem);
}

// Start websocket and user
var socket = io("ws://coinzap.io");
var username = 'filestore.net';
socket.emit('add user', username);

// Set fallback ID
btcpWidgetID = "undefined" !== typeof btcpWidget.data ? btcpWidget.data.id : 'btcpWidget';

toolTipStyles = '.tooltip {position: relative; display: inline-block;} .tooltip .tooltiptext {visibility: hidden; width: 140px; background-color: '+btcpWidgetData[btcpWidgetID]['background']+'; color: #fff; text-align: center; border-radius: '+btcpWidgetData[btcpWidgetID]['border_radius']+'; padding: 5px; position: absolute; z-index: 1; bottom: 150%; left: 50%; margin-left: -75px; opacity: 0; transition: opacity 0.3s;} .tooltip .tooltiptext::after {content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: '+btcpWidgetData[btcpWidgetID]['background']+' transparent transparent transparent;} .tooltip:hover .tooltiptext {visibility: visible; opacity: 1;}';

document.body.innerHTML += '<style>'+toolTipStyles+'</style>';

// Create widget button with styles based on data
var widget = document.createElement("div");
widget.id = "btcpButton";
widget.style.display = "inline-block";
widget.style.width = btcpWidgetData[btcpWidgetID]['width'];
widget.style.height = btcpWidgetData[btcpWidgetID]['height'];
widget.style.padding = btcpWidgetData[btcpWidgetID]['padding'];
widget.style.color = btcpWidgetData[btcpWidgetID]['color'];
widget.style.background = btcpWidgetData[btcpWidgetID]['background'];
widget.style.fontFamily = "Arial";
widget.style.borderRadius = btcpWidgetData[btcpWidgetID]['border_radius'];
// Add logo if that setting enabled
if (btcpWidgetData[btcpWidgetID]['logo']) {
	widget.style.background = 'url(\'data:image/svg+xml;charset=UTF-8,'+btcpLogo+'\') no-repeat 5px 5px '+btcpWidgetData[btcpWidgetID]['background'];
	widget.style.backgroundSize = '24px 24px';
	widget.style.paddingLeft = (26+parseInt(btcpWidgetData[btcpWidgetID]['padding'],10)) + 'px';
}
widget.style.cursor = "pointer";
widget.innerHTML = (btcpWidgetData[btcpWidgetID]['type'] === "Buy" ? "Buy" : "Donate") + " with $BTCP";

var copy = function() {
  document.getElementById("walletAddressInput").select();
  document.execCommand("Copy");
  document.getElementById("myTooltip").style.width = "70px";
  document.getElementById("myTooltip").style.marginLeft = "-40px";
  document.getElementById("myTooltip").innerHTML = "Copied!";
}

function outFunc() {
  document.getElementById("myTooltip").style.width = "140px";
  document.getElementById("myTooltip").style.marginLeft = "-75px";
  document.getElementById("myTooltip").innerHTML = "Copy to clipboard";
}

// On click of widget button, display in an overlay
widget.onclick = function() {btcpWidget.showPaymentScreen();}

btcpWidget.returnScreenHeading = function() {
    // Set overlay DOM styles
    var overlay = document.createElement("div");
    overlay.id = "btcpButtonOverlay";
    overlay.style.position = "fixed";
    overlay.style.display = "block";
    overlay.style.width = "100%";
    overlay.style.top = "0";
    overlay.style.left = "0";
    overlay.style.height = "100%";
    overlay.style.textAlign = "center";
    overlay.style.padding = "0";
    overlay.style.color = "#fff";
    overlay.style.background = "rgba(0,0,0,0.01)";
    overlay.style.fontFamily = "Arial";
    overlay.style.paddingTop = "1500px";
    overlay.style.transition = "all 0.3s ease-in-out";

    var closeLink = document.createElement("div");
    closeLink.style.position = "absolute";
    closeLink.style.display = "inline-block";
    closeLink.style.margin = "-30px auto auto 147px";
    closeLink.style.fontSize = "24px";
    closeLink.style.color = "#555";
    closeLink.style.cursor = "pointer";
    closeLink.onclick = function(){paidEnough ? alert("Payment in progress, please wait") : btcpWidget.doOverlay('hide');};
    closeLink.onmouseover = function(){this.style.color = '#ddd'};
    closeLink.onmouseout = function(){this.style.color = '#555'};
    closeLink.innerHTML = "x";

    var btcpFullLogo = document.createElement("div");
    btcpFullLogo.style.display = "block";
    btcpFullLogo.style.margin = "0 auto 20px auto";
    btcpFullLogo.style.width = "320px";
    btcpFullLogo.style.height = "58px";
    btcpFullLogo.style.background = 'url(\'data:image/svg+xml;charset=UTF-8,'+btcpLogoFull+'\') no-repeat 0 0';
	btcpFullLogo.style.backgroundSize = '320px 58px';
    btcpFullLogo.style.cursor = "pointer";
    btcpFullLogo.onclick = function(){window.open("https://btcprivate.org");};
    btcpFullLogo.oncontextmenu = function(){
        btcpWidget.incrLogoRightClicks(event);
        return false;
    };

    return {'overlay':overlay,'closeLink':closeLink,'btcpFullLogo':btcpFullLogo};
}

btcpWidget.showPaymentScreen = function(anim) {
    // Get heading
    var headingElems = btcpWidget.returnScreenHeading();
    var overlay = headingElems['overlay'];
    var closeLink = headingElems['closeLink'];
    var btcpFullLogo = headingElems['btcpFullLogo'];

    var payAmountText = document.createElement("div");
    payAmountText.id = "payAmountText";
    payAmountText.style.margin = "0 auto";
    payAmountText.innerHTML = 'Please pay <b>'+btcpWidget.data.amount+' BTCP</b> to wallet:';

    var walletAddr = document.createElement("span");
    walletAddr.id = "walletAddress";
    walletAddr.className = "walletAddress";
    walletAddr.style.padding = "10px";
    walletAddr.style.fontSize = "12px";
    walletAddr.style.color = "#fff";
    walletAddr.style.background = "#111";
    walletAddr.innerHTML = btcpWidget.data.wallet;

    var walletAddressInput = document.createElement("input");
    walletAddressInput.id = "walletAddressInput";
    walletAddressInput.type = "text";
    walletAddressInput.value = btcpWidget.data.wallet;
    walletAddressInput.style.position = "absolute";
    walletAddressInput.style.top = "-1000px";

    var clipboardTooltip = document.createElement("div");
    clipboardTooltip.id = "clipboardTooltip";
    clipboardTooltip.className = "tooltip";
    clipboardTooltip.style.margin = "0 auto 24px auto";

    var clipboardLink = document.createElement("a");
    clipboardLink.href = "javascript:copy()";
    clipboardLink.id = "clipboardLink";
    clipboardLink.onmouseout = function() {outFunc()};
    clipboardLink.style.position = "absolute";
    clipboardLink.style.display = "inline-block";
    clipboardLink.style.width = "34px";
    clipboardLink.style.height = "34px";
    clipboardLink.style.top = "3px";
    clipboardLink.style.background = btcpWidgetData[btcpWidgetID]['background'];

    var clipboardTooltipText = document.createElement("span");
    clipboardTooltipText.id = "myTooltip";
    clipboardTooltipText.className = "tooltiptext";
    clipboardTooltipText.innerHTML = "Copy to clipboard";

    var clipboard = document.createElement("div");
    clipboard.style.position = "absolute";
    clipboard.style.display = "inline-block";
    clipboard.style.top = "6px";
    clipboard.style.left = "7px";
    clipboard.style.width = "23px";
    clipboard.style.height = "23px";
    clipboard.style.background = 'url(\'data:image/svg+xml;charset=UTF-8,'+clipboardIcon+'\') no-repeat 0 0';
	clipboard.style.backgroundSize = '20px 20px';
    clipboard.style.cursor = "pointer";

    /* var walletButton = document.createElement("a");
    walletButton.id = "electrumButton";
    walletButton.style.display = "block";
    walletButton.style.width = "176px";
    walletButton.style.margin = "20px auto 5px auto";
    walletButton.style.fontSize = "18px";
    walletButton.style.color = "#fff";
    walletButton.style.background = btcpWidgetData[btcpWidgetID]['background'];
    walletButton.style.borderRadius = btcpWidgetData[btcpWidgetID]['border_radius'];
    walletButton.style.padding = "10px";
    walletButton.style.textDecoration = "none";
    walletButton.innerHTML = "Pay via BTCP wallet";
    walletButton.href = btcpURI; */

    var walletButton = btcpWidget.returnButton();
    walletButton.id = "electrumButton";
    walletButton.style.width = "176px";
    walletButton.innerHTML = "Pay via BTCP wallet";
    walletButton.href = btcpURI;

    var walletWhat = document.createElement("a");
    walletWhat.id = "walletWhat";
    walletWhat.style.fontSize = "10px";
    walletWhat.style.color = "#bbb";
    walletWhat.style.textDecoration = "none";
    walletWhat.innerHTML = "What is this?";
    walletWhat.href = "javascript:alert(\'Expand div to explain what it is, uses etc\')";

    var walletGet = document.createElement("a");
    walletGet.id = "walletGet";
    walletGet.style.fontSize = "10px";
    walletGet.style.color = "#bbb";
    walletGet.style.textDecoration = "none";
    walletGet.style.margin = "0 0 20px 5px";
    walletGet.innerHTML = "Get it!";
    walletGet.href = "javascript:alert(\'Go to link to get it...\')";

    var qrCodeHeading = document.createElement("b");
    qrCodeHeading.id = "qrCodeHeading";
    qrCodeHeading.style.display = "block";
    qrCodeHeading.style.margin = "20px auto 10px auto";
    qrCodeHeading.innerHTML = "or by QR Code:";

    var qrCodeElem = document.createElement("div");
    qrCodeElem.id = "qrCode";
    qrCodeElem.style.display = "inline-block";
    qrCodeElem.style.marginBottom = "20px";
    qrCodeElem.style.padding = "10px";
    qrCodeElem.style.background = "#fff";

    var transactionRef = document.createElement("div");
    transactionRef.id = "transactionRef";
    transactionRef.style.display = "none";
    transactionRef.style.width = "200px";
    transactionRef.style.margin = "5px auto 20px auto";
    transactionRef.innerHTML = "Transaction ref: "+btcpWidget.transactionRef;

    var orderProgressBarContainer = document.createElement("div");
    orderProgressBarContainer.id = "orderProgressBarContainer";
    orderProgressBarContainer.style.display = "none";
    orderProgressBarContainer.style.width = "200px";
    orderProgressBarContainer.style.margin = "5px auto 20px auto";
    orderProgressBarContainer.style.textAlign = "left";
    orderProgressBarContainer.style.background = "#888";
    orderProgressBarContainer.innerHTML = '<div id="orderProgressBar" style="display: inline-block; width: 0; background: #272d63; transition: all 0.5s ease-in-out">&nbsp;</div>';

    var orderProgressInfo = document.createElement("b");
    orderProgressInfo.id = "orderProgressInfo";
    orderProgressInfo.style.display = "block";
    orderProgressInfo.style.marginBottom = "5px";
    orderProgressInfo.innerHTML = "Order completes after:<br>"+(approvalOnRecognition ? "BTCP sent" : approvalConfirmsNeeded+" confirmations");

    var helpLink = document.createElement("a");
    helpLink.style.fontSize = "10px"
    helpLink.style.color = "#bbb";
    helpLink.style.textDecoration = "none";
    helpLink.innerHTML = "Need help?";
    helpLink.href = "https://support.btcprivate.org/";
    helpLink.target = "_blank";

    clipboardLink.appendChild(clipboardTooltipText);
    clipboardLink.appendChild(clipboard);
    clipboardTooltip.appendChild(clipboardLink);

    overlay.appendChild(closeLink);
    overlay.appendChild(btcpFullLogo);
    overlay.appendChild(payAmountText);
    overlay.appendChild(walletAddr);
    overlay.appendChild(walletAddressInput);
    overlay.appendChild(clipboardTooltip);
    overlay.appendChild(walletButton);
    overlay.appendChild(walletWhat);
    overlay.appendChild(walletGet);
    overlay.appendChild(qrCodeHeading);
    overlay.appendChild(qrCodeElem);
    overlay.appendChild(transactionRef);
    overlay.appendChild(orderProgressBarContainer);
    overlay.appendChild(orderProgressInfo);
    overlay.appendChild(helpLink);

    // Add overlay with 4 options to merchants website
    document.body.insertAdjacentElement('afterend',overlay);
    // Do regular 'show' anim unless an anim specified
    btcpWidget.doOverlay(!anim ? 'show' : anim);

    $('#qrCode').qrcode(btcpURI);
}

btcpWidget.showMerchantSupportScreen = function(anim) {
    get('btcpButtonOverlay').parentNode.removeChild(get('btcpButtonOverlay'));
    // Get heading
    var headingElems = btcpWidget.returnScreenHeading();
    var overlay = headingElems['overlay'];
    var closeLink = headingElems['closeLink'];
    var btcpFullLogo = headingElems['btcpFullLogo'];

    var merchantSupportText = document.createElement("div");
    merchantSupportText.style.margin = "0 auto";
    merchantSupportText.innerHTML = 'Merchant Support<br><br>Widget Version v'+btcpWidget.version;

    var displaySetupInfoButton = btcpWidget.returnButton();
    displaySetupInfoButton.style.width = "176px";
    displaySetupInfoButton.style.cursor = "pointer";
    displaySetupInfoButton.innerHTML = "Display Setup Info";
    displaySetupInfoButton.onclick = function() {
        btcpWidget.displayInfo();
    }

    var vendorsSiteButton = btcpWidget.returnButton();
    vendorsSiteButton.style.width = "176px";
    vendorsSiteButton.innerHTML = "vendors.btcprivate.org";
    vendorsSiteButton.href = "https://vendors.btcprivate.org";
    vendorsSiteButton.target = "_blank";

    var supportSiteButton = btcpWidget.returnButton();
    supportSiteButton.style.width = "176px";
    supportSiteButton.innerHTML = "support.btcprivate.org";
    supportSiteButton.href = "https://support.btcprivate.org";
    supportSiteButton.target = "_blank";

    var mainSiteButton = btcpWidget.returnButton();
    mainSiteButton.style.width = "176px";
    mainSiteButton.innerHTML = "btcprivate.org";
    mainSiteButton.href = "https://btcprivate.org";
    mainSiteButton.target = "_blank";

    var backLink = document.createElement("a");
    backLink.style.display = "block"
    backLink.style.fontSize = "10px"
    backLink.style.color = "#bbb";
    backLink.style.textDecoration = "none";
    backLink.style.margin = "20px auto 0 auto";
    backLink.style.cursor = "pointer";
    backLink.innerHTML = "&lt;&lt;&lt; Back";
    backLink.onclick = function() {
        get('btcpButtonOverlay').parentNode.removeChild(get('btcpButtonOverlay'));
        btcpWidget.showPaymentScreen('show-instant');
    };

    overlay.appendChild(closeLink);
    overlay.appendChild(btcpFullLogo);
    overlay.appendChild(merchantSupportText);
    overlay.appendChild(displaySetupInfoButton);
    overlay.appendChild(vendorsSiteButton);
    overlay.appendChild(supportSiteButton);
    overlay.appendChild(mainSiteButton);
    overlay.appendChild(backLink);

    // Add overlay with 4 options to merchants website
    document.body.insertAdjacentElement('afterend',overlay);
    // Do regular 'show' anim unless an anim specified
    btcpWidget.doOverlay('show-instant');
}

btcpWidget.returnButton = function() {
    var button = document.createElement("a");
    button.style.display = "block";
    button.style.width = "auto";
    button.style.margin = "20px auto 5px auto";
    button.style.fontSize = "18px";
    button.style.color = "#fff";
    button.style.background = btcpWidgetData[btcpWidgetID]['background'];
    button.style.borderRadius = btcpWidgetData[btcpWidgetID]['border_radius'];
    button.style.padding = "10px";
    button.style.textDecoration = "none";
    return button;
}

btcpWidget.doOverlay = function(vis) {
    var winH = window.innerHeight;
    var topH = (winH - 505) / 2;
    if (vis === "show") {
        setTimeout(function () {
            get('btcpButtonOverlay').style.paddingTop = ((topH > 0 ? topH : 0) + 30)+"px";
            get('btcpButtonOverlay').style.background = "rgba(0,0,0,0.9)";
        },0);
        setTimeout(function () {
            get('btcpButtonOverlay').style.transition = "all 0.05s ease-in-out";
        },300);
        setTimeout(function () {
            get('btcpButtonOverlay').style.paddingTop = ((topH > 0 ? topH : 0) + 40)+"px";
        },420);
    }
    if (vis === "hide") {
        get('btcpButtonOverlay').style.transition = "all 0.05s ease-in-out";
        get('btcpButtonOverlay').style.paddingTop = ((topH > 0 ? topH : 0) + 30)+"px";
        setTimeout(function () {
            get('btcpButtonOverlay').style.transition = "all 0.5s ease-in-out";
            get('btcpButtonOverlay').style.paddingTop = "1500px";
        },120);
        setTimeout(function () {
            get('btcpButtonOverlay').style.background = "rgba(0,0,0,0.01)";
        },320);
        setTimeout(function () {
            get('btcpButtonOverlay').style.display = "none";
        },620);
    }
    if (vis === "reposition" && get('btcpButtonOverlay') && get('btcpButtonOverlay').style.paddingTop !== "1500px") {
        get('btcpButtonOverlay').style.transition = "0";
        get('btcpButtonOverlay').style.paddingTop = ((topH > 0 ? topH : 0) + 30)+"px";
    }
    if (vis === "show-instant") {
        get('btcpButtonOverlay').style.transition = "0";
        get('btcpButtonOverlay').style.paddingTop = ((topH > 0 ? topH : 0) + 30)+"px";
        get('btcpButtonOverlay').style.background = "rgba(0,0,0,0.9)";
    }
}

// Add widget to merchants site
get(btcpWidgetID).insertAdjacentElement('afterend',widget);

// Handle socket comms for order confirmation response
btcpWidget.handlePaymentResponse = function(data) {
  // Hide overlay after 1 sec (the delay is less snappy)
  setTimeout(function() {
      btcpWidget.doOverlay('hide');
  },1000);
  // User confirmed payment approval
  if (data.result === 'success') {
      // Update button
      if (btcpWidgetData[btcpWidgetID]['logo']) {
          get('btcpButton').style.background = 'url(\'data:image/svg+xml;charset=UTF-8,'+btcpLogo+'\') no-repeat 5px 5px #080';
          get('btcpButton').style.backgroundSize = '24px 24px';
      } else {
          get('btcpButton').style.background = "#080";
      }
      setTimeout(function() {
          get('btcpButton').innerHTML = "Authorized, proceeding with order...";
      },2000);
      // Run success function and pass through data
      btcpWidget.onPaymentSuccess(data);
  }
  // User cancelled payment approval
  if (data.result === 'failed') {
      // Update button
      if (btcpWidgetData[btcpWidgetID]['logo']) {
          get('btcpButton').style.background = 'url(\'data:image/svg+xml;charset=UTF-8,'+btcpLogo+'\') no-repeat 5px 5px #b00';
          get('btcpButton').style.backgroundSize = '24px 24px';
      } else {
          get('btcpButton').style.background = "#b00";
      }
      setTimeout(function() {
          get('btcpButton').innerHTML = "Order cancelled...";
      },2000);
      // Run fail function and pass through data
      btcpWidget.onPaymentFail(
          {
              'reason' : 'Order cancelled'
          }
      );
      // Set button back to previous state so they could buy again
      setTimeout(function() {
          if (btcpWidgetData[btcpWidgetID]['logo']) {
              get('btcpButton').style.background = 'url(\'data:image/svg+xml;charset=UTF-8,'+btcpLogo+'\') no-repeat 5px 5px #272d63';
              get('btcpButton').style.backgroundSize = '24px 24px';
          } else {
              get('btcpButton').style.background = "#272d63";
          }
          setTimeout(function() {
              get('btcpButton').innerHTML = "Pay with $BTCP";
          },1000);
      },4000);
  }
};

btcpWidget.logoRightClicks = 0;
// Increment right mouse clicks on logo till 3
btcpWidget.incrLogoRightClicks = function(e) {
  if (btcpWidget.logoRightClicks == 2) {
      // Will be 3rd click in a moment, show merchant support
      btcpWidget.showMerchantSupportScreen();
  }
  btcpWidget.logoRightClicks += btcpWidget.logoRightClicks < 3 ? 1 : -2;
}

btcpWidget.getSetupInfo = function() {
    var date = new Date();
    var info = "<pre>"+
               "=============================\n=== BTCP Merchant Support ===\n===  Widget version v"+btcpWidget.version+"  ===\n===   Vendor Setup Info   ===\n=============================\n\n"+date+"\n\n\n\n"+
               "==========================\nbtcp_widget_data innerHTML\n==========================\n\n"+get('btcp_widget_data').innerHTML+"\n\n\n\n"+
               "===================\n"+btcpWidget.data.id+" script src\n===================\n\n"+get(btcpWidget.data.id).src+"\n\n\n\n"+
               "================\nnavigator object\n================\n\n"+btcpWidget.navigatorProperties()+"\n\n\n\n"+
               "=============\nwindow object\n=============\n\n"+btcpWidget.objToString(window);
    return info;
}

btcpWidget.objToString = function(obj) {
    var str = '';
    for (var p in obj) {
        if (obj.hasOwnProperty(p)) {
            str += p + '::' + obj[p] + '\n';
        }
    }
    return str;
}

btcpWidget.navigatorProperties = function(){
    var info = "";
    for(var property in navigator){ 
        var str = navigator[property]
        info += property+"::"+str+"\n";
    }
    return info;
}
btcpWidget.displayInfo = function() {
    var info = btcpWidget.getSetupInfo();
    window.open('about:blank').document.body.innerHTML = info;
}

window.addEventListener("resize", function(event) {
    btcpWidget.doOverlay('reposition');
});

const explorerLink = '<a href="https://explorer.btcprivate.org/address/'+address+'" target="_blank" style="text-decoration: none; color: #fff">[&gt;]</a>';
paidEnough = false;
numConfirms = 0;
// Load libs:
var bitcore = require('bitcore-lib-btcp');
var socket = io('http://54.212.206.172:8001');
socket.emit('subscribe', 'bitcoind/hashblock');
socket.emit('subscribe', 'bitcoind/addresstxid', [address]);
socket.emit('subscribe', 'bitcoind/rawtransaction');

const processPayment = function() {
    // Unsubsribe from websockets
    socket.emit('unsubscribe', 'bitcoind/hashblock');
    socket.emit('unsubscribe', 'bitcoind/addresstxid', [address]);

    // Setup a JSON response
    var jsonResponse = '{'+
            '"result"   : "success",'+
            '"token"    : "abcdef",'+
            '"txid"     : "'+btcpWidget.txID+'",'+
            '"confirms" : '+numConfirms+
         '}';
    // Handle the payment response with that JSON data
    btcpWidget.handlePaymentResponse(JSON.parse(jsonResponse));
}

// On addresstxid subscription response
socket.on('bitcoind/addresstxid', function(data) {
  // Get and confirm address
  var bitcoreAddress = bitcore.Address(data.address);
  if (bitcoreAddress.toString() == address && paidEnough) {
      // Set transaction ID and update progress info
      btcpWidget.txID = data.txid;
      displayProcessingMessage();
   }
});
// May be useful, can decode as JSON using use RPC method 'decodeRawTransaction'
// Info on that function: https://github.com/BTCPrivate/BitcoinPrivate/blob/8a28216fa9796dffb1bdce0103aaa21476fb66c0/src/rpcrawtransaction.cpp#L188
// ch4ot1c note: you can decode it with the decoderawtransaction rpc method (do the decoding on the daemon) with bitcore-lib-btcp / btcprivate-js
socket.on('bitcoind/rawtransaction', function(transactionHex) {
    if ("undefined" == typeof amountToPay) {
        amountToPay = amount;
        console.log("SET amountToPay to "+amountToPay);
    }
    // Get outputs from tx hex
    var o = bitcore.Transaction(transactionHex).outputs;
    // Cycle through and find our address in that tx block
    for (var i=0; i<o.length; i++) {
        if (bitcore.Address.fromScript(bitcore.Script.fromBuffer(o[i]._scriptBuffer)).toString() == address) {
            // Check user has paid correct amount
            // TODO: if not enough paid, display messaging that user needs to pay more
            console.log(address + " FOUND");
            console.log(o);
            console.log(o[i]);
            console.log(o[i].satoshis + " VS " + (amountToPay * 100000000));
            // Paid too little (5000 sats or less under required amount)
            if (o[i].satoshis < amountToPay * (100000000 - 5000)) {
                // Set amount to pay and alert user
                amountToPay = (amountToPay - (o[i].satoshis / 100000000)).toFixed(8) * 1;
                alert('You seem to have paid '+amountToPay+' BTCP too little.\n\nPlease pay this extra amount to continue.');
                // Set params back to start point and new message
                paidEnough = false;
                numConfirms = 0;
                get('orderProgressInfo').innerHTML = "Please pay remaining:<br>"+amountToPay+" BTCP to continue ";
                get('payAmountText').innerHTML = 'Please pay <b>'+amountToPay+' BTCP</b> to wallet:'
                // Set new URI
                btcpURI = 'bitcoin:'+encodeURI(btcpWidget.data.wallet)+
                    '?amount='+amountToPay+
                    '&message='+encodeURI(btcpWidget.data.description)+
                    '&r='+encodeURI(btcpWidget.getLocation(window.location).origin);
                // Apply that to button and QR code
                get('electrumButton').href = btcpURI;
                $('#qrCode')[0].innerHTML = "";
                $('#qrCode').qrcode(btcpURI);
            // Paid too much (5000 sats or more under required amount)
            } else if (o[i].satoshis > amountToPay * (100000000 + 5000)) {
                // Set amount overpaid and alert user
                amountToPay = ((o[i].satoshis / 100000000) - amountToPay).toFixed(8) * 1;
                alert('You seem to have paid '+amountToPay+' BTCP too much.\n\nPlease contact merchant to discuss any partial refund.');
                // Permit order to proceed
                paidEnough = true;
                displayProcessingMessage();
            // Paid roughly right amount
            } else {
                paidEnough = true;
                displayProcessingMessage();
            }
            break;
        }
    }
});

// On receiving hashblock info, get the hex for it
socket.on('bitcoind/hashblock', function(blockhashHex) {
    if (paidEnough) {
        // Increase number of confirms
        numConfirms++;
        // Display relevant message
        if (numConfirms === 0) {
            console.log("Transaction created within block");
            get('orderProgressInfo').innerHTML = "BTCP payment progress:<br>Received on block "+explorerLink;
        } else {
            get('orderProgressInfo').innerHTML = "BTCP payment progress:<br>"+numConfirms+" of "+approvalConfirmsNeeded+" confirms "+explorerLink;
            get('orderProgressBar').style.width = (((numConfirms+1)/(approvalConfirmsNeeded+1))*200) + "px";
        }
        // If at or above number of confirms needed for approval
        if (numConfirms >= approvalConfirmsNeeded) {
          processPayment();
        }
        console.log(numConfirms + " :: " + blockhashHex);
    }
});

var displayProcessingMessage = function() {
    get('payAmountText').style.display = "none";
    get('walletAddress').style.display = "none";
    get('walletAddressInput').style.display = "none";
    get('clipboardTooltip').style.display = "none";
    get('electrumButton').style.display = "none";
    get('walletWhat').style.display = "none";
    get('walletGet').style.display = "none";
    get('qrCodeHeading').style.display = "none";
    get('qrCode').style.display = "none";
    get('transactionRef').style.display = "block";
    get('orderProgressBarContainer').style.display = "block";
    get('orderProgressInfo').innerHTML = "BTCP payment recognised<br>Please wait for confirms... "+explorerLink;
    setTimeout(function() {
        get('orderProgressBar').style.width = ((1/(approvalConfirmsNeeded+1))*200) + "px";
    },200);
    if (approvalOnRecognition) {
        processPayment();
    }
}

// On document load
window.onload = function() {
    get("wallet").innerHTML = address;
};
